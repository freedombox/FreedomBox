##
## On all sites, provide I2P on a default path: /i2p
##
## Requires the following Apache modules to be enabled:
##   mod_headers
##   mod_proxy
##   mod_proxy_http
##   mod_proxy_html
##
<Location /i2p>
    # Disable compression
    # As soon as it has to be chunked, it doesn't work
    RequestHeader unset Accept-Encoding

    ProxyPass               http://localhost:7657
    ProxyPassReverse        http://localhost:7657

    # Rewrite absolute urls from i2p to pass through apache
    ProxyHTMLEnable On
    ProxyHTMLURLMap  /  /i2p/

    Include          includes/freedombox-single-sign-on.conf
    <IfModule mod_auth_pubtkt.c>
        TKTAuthToken "admin" "i2p"
    </IfModule>
</Location>

# Catch some other root i2p addresses
# These are most likely generated by javascript
RedirectMatch "^/(i2p[^/]+.*)" "/i2p/$1"
